#!/bin/sh
#4.1.1
#2018-12-08

#Copyright (C) 2018 Brandon Zorn, brandonzorn@cock.li
#
#This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <https://www.gnu.org/licenses/>.

if [ "$(id -u)" -eq 0 ];then printf "Do not run as root\n";exit;fi

cache_rm(){
	cache="${XDG_CACHE_HOME}/${cachedir}/${data##*/}"
	if [ -d "${cache}" ];then sleep 3;rm -rf "${cache}";fi
}

launch(){ ${ver} --user-data-dir="${data}"; }

#ver="chromium"
#cachedir="chromium"
ver="google-chrome-unstable"
cachedir="chrome"
config="${HOME}/.config/chrome/${ver}"
mode="${0##*/}"

while true;do
	case "${1}" in
		-c) ver="chromium";cachedir="${ver}";shift;;
		-g1) ver="google-chrome-unstable";cachedir="chrome";shift;;
		-g2) ver="google-chrome-beta";cachedir="chrome";shift;;
		-g3) ver="google-chrome";cachedir="chrome";shift;;
		-h)
			printf "GENERAL\n"
			printf " -h\tprint this help\n"
			printf " -c\tchromium\n"
			printf " -g1\tgoogle-chrome-unstable\n"
			printf " -g2\tgoogle-chrome-beta\n"
			printf " -g3\tgoogle-chrome\n"
			exit;;
		*) break;;
	esac
done

case "${mode}" in
	chromium-default)
		data="${config}-default"
		launch
		cache_rm
		;;
	chromium-ex1)
		data="${config}-ex1"
		launch
		cache_rm
		;;
	chromium-ex2)
		data="${config}-ex2"
		launch
		cache_rm
		;;
	chromium-ex3)
		data="${config}-ex3"
		launch
		cache_rm
		;;
	chromium-sandbox)
		finish(){ if [ -d "${data}" ];then rm --preserve-root -r "${data}";fi }
		trap 'exit 1' INT HUP QUIT TERM USR1
		trap finish EXIT
		data=$(mktemp -d)
		launch
		;;
esac
