#!/bin/sh
#4.3.0
#2018-12-20

#Copyright (C) 2018 Brandon Zorn, brandonzorn@cock.li
#
#This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <https://www.gnu.org/licenses/>.

if [ "$(id -u)" -eq 0 ];then printf "Do not run as root\n";exit;fi

launch(){
	${ver} --user-data-dir="${data}"
	cache="${XDG_CACHE_HOME}/${cachedir}/${data##*/}"
	if [ -d "${cache}" ];then sleep 3;rm -rf "${cache}";fi
}

#ver="chromium"
#cachedir="chromium"

ver="google-chrome-unstable"
cachedir="chrome"

config="${HOME}/.config/chrome/${ver}"

mode="${0##*/chromium-}"
E="${mode}"

while true;do
	case "${1}" in
		-e[0-9]) mode="main";E="ex${1##-e}";shift;;
		-d) mode="main";E="default";shift;;
		-s) mode="sandbox";shift;;
		-c) ver="chromium";cachedir="chromium";shift;;
		-g1) ver="google-chrome-unstable";cachedir="chrome";shift;;
		-g2) ver="google-chrome-beta";cachedir="chrome";shift;;
		-g3) ver="google-chrome";cachedir="chrome";shift;;
		-h)
			printf "PROFILE\n"
			printf " -d\tdefault\n"
			printf " -e#\tex#, where '#' is [0-9]\n"
			printf " -s\tsandbox, all data deleted on close\n"
			printf "\nBROWSER\n"
			printf " -c\tchromium\n"
			printf " -g1\tgoogle-chrome-unstable\n"
			printf " -g2\tgoogle-chrome-beta\n"
			printf " -g3\tgoogle-chrome\n"
			printf "\nGENERAL\n"
			printf " -h\tprint this help\n"
			exit;;
		*) break;;
	esac
done

if [ "${mode}" = "sandbox" ];then
	finish(){ if [ -d "${data}" ];then rm --preserve-root -r "${data}";fi }
	trap 'exit 1' INT HUP QUIT TERM USR1
	trap finish EXIT
	data=$(mktemp -d)
	launch
else
	data="${config}-${E}"
	launch
fi
